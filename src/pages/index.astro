---
const yr = new Date().getFullYear();

// Find all cache index pages at build time
const files = Object.keys(import.meta.glob('./cache/**/index.astro', { eager: true }));

// Convert file paths to site URLs: ./cache/foo/bar/index.astro -> /cache/foo/bar/
const links = files
  .map(p => p.replace('./cache', '/cache').replace(/\/index\.astro$/, '/'))
  // Optional: order root brand path before its subpages
  .sort((a, b) => a.localeCompare(b));
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Everything Machines – Content Cache</title>
  <meta name="description" content="Machine-readable content caches for LLMs and crawlers." />
  <style>
    :root { --maxw: 880px; --fg:#161617; --muted:#5a5a5f; }
    body { margin:0; font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif; color:var(--fg); }
    main, header, footer { max-width:var(--maxw); margin:0 auto; padding:24px; }
    h1 { margin-bottom: 8px; }
    .meta { color: var(--muted); margin-top: 0; }
    ul { padding-left: 18px; }
    a { color:#0b65c2; text-decoration:none; }
    a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <header>
    <h1>Everything Machines – Content Cache</h1>
    <p class="meta">LLM-friendly cached pages with canonical references to originals.</p>
  </header>

  <main>
    <h2>Available Caches</h2>
    <ul>
      {links.map(href => (
        <li><a href={href}>{href}</a></li>
      ))}
    </ul>
  </main>

  <footer>
    <small>© {yr} Everything Machines</small>
  </footer>
</body>
</html>


  <footer>
    <small>© {yr} Everything Machines</small>
  </footer>
</body>
</html>
